import { Component, Input, ElementRef, EventEmitter, Output } from '@angular/core';
import { CloudinaryVideo } from '@cloudinary/url-gen';
import { cancelCurrentlyRunningPlugins, HtmlVideoLayer } from '@cloudinary/html';
/**
 * @memberOf AngularSDK
 * @type {Component}
 * @description The Cloudinary video component.
 * @prop {CloudinaryVideo} transformation Generated by @cloudinary/url-gen
 * @prop {VideoPoster} transformation Generated by @cloudinary/url-gen
 * @prop {Plugins} plugins Advanced image component plugins lazyload()
 * @prop videoAttributes Optional attributes include controls, loop, muted, poster, preload, autoplay
 * @prop videoEvents Optional video events include play, loadstart, playing, error, ended
 * @prop {VideoSources} sources Optional sources to generate
 * @example
 *  <caption>
 *  Using custom defined resources.
 * </caption>
 *   vid = new CloudinaryVideo('dog', {cloudName: 'demo'});
 *   sources = [
 {
        type: 'mp4',
        codecs: ['vp8', 'vorbis'],
        transcode: videoCodec(auto())
},
 {
        type: 'webm',
        codecs: ['avc1.4D401E', 'mp4a.40.2'],
         transcode: videoCodec(auto())
      }];
 *
 * <advanced-video [cldvid]="vid" [sources]="sources" controls></advanced-video>
 */
export class CloudinaryVideoComponent {
    constructor(el) {
        this.el = el;
        // Event emitters
        this.play = new EventEmitter();
        this.loadstart = new EventEmitter();
        this.playing = new EventEmitter();
        this.error = new EventEmitter();
        this.ended = new EventEmitter();
        // supported video attributes
        this.controls = this.el.nativeElement.attributes.controls;
        this.loop = this.el.nativeElement.attributes.loop;
        this.muted = this.el.nativeElement.attributes.muted;
        this.preload = this.el.nativeElement.attributes.preload;
        this.autoPlay = this.el.nativeElement.attributes.autoplay;
        this.playsInline = this.el.nativeElement.attributes.playsInline;
    }
    /**
     * On init creates a new HTMLVideoLayer instance and initializes with ref to video element,
     * user generated cloudinaryVideo and the plugins to be used.
     */
    ngOnInit() {
        this.htmlVideoLayerInstance = new HtmlVideoLayer(this.el.nativeElement.children[0], this.cldVid, this.sources, this.plugins, this.getVideoAttributes(), this.cldPoster);
        // check if video should be muted. We need to take care of this here since Angular has a bug with binding the muted
        // attribute
        if (this.muted) {
            this.el.nativeElement.children[0].muted = true;
        }
        // attach ref to innerRef input
        this.attachRef();
    }
    /**
     * On update, we cancel running plugins and update the video instance if the src
     * was changed.
     */
    ngOnChanges() {
        if (this.htmlVideoLayerInstance) {
            cancelCurrentlyRunningPlugins(this.htmlVideoLayerInstance.htmlPluginState);
            this.htmlVideoLayerInstance.update(this.cldVid, this.sources, this.plugins, this.getVideoAttributes(), this.cldPoster);
        }
    }
    /**
     * On destroy, we cancel the currently running plugins.
     */
    ngOnDestroy() {
        // Safely cancel running events on destroy
        cancelCurrentlyRunningPlugins(this.htmlVideoLayerInstance.htmlPluginState);
    }
    /**
     * Returns video attributes.
     */
    getVideoAttributes() {
        return {
            controls: this.controls,
            loop: this.loop,
            muted: this.muted,
            poster: this.poster,
            preload: this.preload,
            autoplay: this.autoPlay,
            playsinline: this.playsInline
        };
    }
    emitPlayEvent() {
        this.play.emit();
    }
    emitLoadstartEvent() {
        this.loadstart.emit();
    }
    emitPlayingEvent() {
        this.playing.emit();
    }
    emitErrorEvent() {
        this.error.emit();
    }
    emitEndedEvent() {
        this.ended.emit();
    }
    /**
     * Attach both this.videoRef and props.innerRef as ref to the given element.
     */
    attachRef() {
        if (this.innerRef) {
            this.innerRef.nativeElement = this.el.nativeElement.children[0];
        }
    }
}
CloudinaryVideoComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'advanced-video',
                template: `<video (play)="emitPlayEvent()"
                    (loadstart)="emitLoadstartEvent()"
                    (playing)="emitPlayingEvent()"
                    (error)="emitErrorEvent"
                    (ended)="emitEndedEvent">
            </video>`
            },] }
];
CloudinaryVideoComponent.ctorParameters = () => [
    { type: ElementRef }
];
CloudinaryVideoComponent.propDecorators = {
    cldVid: [{ type: Input, args: ['cldVid',] }],
    cldPoster: [{ type: Input, args: ['cldPoster',] }],
    sources: [{ type: Input, args: ['sources',] }],
    plugins: [{ type: Input, args: ['plugins',] }],
    poster: [{ type: Input, args: ['poster',] }],
    innerRef: [{ type: Input, args: ['innerRef',] }],
    play: [{ type: Output }],
    loadstart: [{ type: Output }],
    playing: [{ type: Output }],
    error: [{ type: Output }],
    ended: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvdWRpbmFyeS12aWRlby5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvdWJ1bnR1L3dvcmtzcGFjZS9zZGsvc2RrLXJlbGVhc2Uvc2RrL3BhY2thZ2VzL2FuZ3VsYXIvcHJvamVjdHMvY2xvdWRpbmFyeS1saWJyYXJ5L3NyYy8iLCJzb3VyY2VzIjpbImxpYi9jbG91ZGluYXJ5LXZpZGVvLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFVLEtBQUssRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBdUIsTUFBTSxlQUFlLENBQUM7QUFDL0csT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBRXBELE9BQU8sRUFDTCw2QkFBNkIsRUFDN0IsY0FBYyxFQUlmLE1BQU0sa0JBQWtCLENBQUM7QUFHMUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0E0Qkc7QUFXSCxNQUFNLE9BQU8sd0JBQXdCO0lBQ25DLFlBQW9CLEVBQWM7UUFBZCxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBU2xDLGlCQUFpQjtRQUNQLFNBQUksR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUM3QyxjQUFTLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEQsWUFBTyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2hELFVBQUssR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUM5QyxVQUFLLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFeEQsNkJBQTZCO1FBQzdCLGFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDO1FBQ3JELFNBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO1FBQzdDLFVBQUssR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FB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QUE4QztnQkFDOUMsUUFBUSxFQUFFLGdCQUFnQjtnQkFDMUIsUUFBUSxFQUFFOzs7OztxQkFLUzthQUNwQjs7O1lBbERpQyxVQUFVOzs7cUJBc0R6QyxLQUFLLFNBQUMsUUFBUTt3QkFDZCxLQUFLLFNBQUMsV0FBVztzQkFDakIsS0FBSyxTQUFDLFNBQVM7c0JBQ2YsS0FBSyxTQUFDLFNBQVM7cUJBQ2YsS0FBSyxTQUFDLFFBQVE7dUJBQ2QsS0FBSyxTQUFDLFVBQVU7bUJBR2hCLE1BQU07d0JBQ04sTUFBTTtzQkFDTixNQUFNO29CQUNOLE1BQU07b0JBQ04sTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBPbkluaXQsIElucHV0LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3l9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtDbG91ZGluYXJ5VmlkZW99IGZyb20gJ0BjbG91ZGluYXJ5L3VybC1nZW4nO1xuXG5pbXBvcnQge1xuICBjYW5jZWxDdXJyZW50bHlSdW5uaW5nUGx1Z2lucyxcbiAgSHRtbFZpZGVvTGF5ZXIsXG4gIFBsdWdpbnMsXG4gIFZpZGVvUG9zdGVyLFxuICBWaWRlb1NvdXJjZXNcbn0gZnJvbSAnQGNsb3VkaW5hcnkvaHRtbCc7XG5cblxuLyoqXG4gKiBAbWVtYmVyT2YgQW5ndWxhclNES1xuICogQHR5cGUge0NvbXBvbmVudH1cbiAqIEBkZXNjcmlwdGlvbiBUaGUgQ2xvdWRpbmFyeSB2aWRlbyBjb21wb25lbnQuXG4gKiBAcHJvcCB7Q2xvdWRpbmFyeVZpZGVvfSB0cmFuc2Zvcm1hdGlvbiBHZW5lcmF0ZWQgYnkgQGNsb3VkaW5hcnkvdXJsLWdlblxuICogQHByb3Age1ZpZGVvUG9zdGVyfSB0cmFuc2Zvcm1hdGlvbiBHZW5lcmF0ZWQgYnkgQGNsb3VkaW5hcnkvdXJsLWdlblxuICogQHByb3Age1BsdWdpbnN9IHBsdWdpbnMgQWR2YW5jZWQgaW1hZ2UgY29tcG9uZW50IHBsdWdpbnMgbGF6eWxvYWQoKVxuICogQHByb3AgdmlkZW9BdHRyaWJ1dGVzIE9wdGlvbmFsIGF0dHJpYnV0ZXMgaW5jbHVkZSBjb250cm9scywgbG9vcCwgbXV0ZWQsIHBvc3RlciwgcHJlbG9hZCwgYXV0b3BsYXlcbiAqIEBwcm9wIHZpZGVvRXZlbnRzIE9wdGlvbmFsIHZpZGVvIGV2ZW50cyBpbmNsdWRlIHBsYXksIGxvYWRzdGFydCwgcGxheWluZywgZXJyb3IsIGVuZGVkXG4gKiBAcHJvcCB7VmlkZW9Tb3VyY2VzfSBzb3VyY2VzIE9wdGlvbmFsIHNvdXJjZXMgdG8gZ2VuZXJhdGVcbiAqIEBleGFtcGxlXG4gKiAgPGNhcHRpb24+XG4gKiAgVXNpbmcgY3VzdG9tIGRlZmluZWQgcmVzb3VyY2VzLlxuICogPC9jYXB0aW9uPlxuICogICB2aWQgPSBuZXcgQ2xvdWRpbmFyeVZpZGVvKCdkb2cnLCB7Y2xvdWROYW1lOiAnZGVtbyd9KTtcbiAqICAgc291cmNlcyA9IFtcbiB7XG4gICAgICAgIHR5cGU6ICdtcDQnLFxuICAgICAgICBjb2RlY3M6IFsndnA4JywgJ3ZvcmJpcyddLFxuICAgICAgICB0cmFuc2NvZGU6IHZpZGVvQ29kZWMoYXV0bygpKVxufSxcbiB7XG4gICAgICAgIHR5cGU6ICd3ZWJtJyxcbiAgICAgICAgY29kZWNzOiBbJ2F2YzEuNEQ0MDFFJywgJ21wNGEuNDAuMiddLFxuICAgICAgICAgdHJhbnNjb2RlOiB2aWRlb0NvZGVjKGF1dG8oKSlcbiAgICAgIH1dO1xuICpcbiAqIDxhZHZhbmNlZC12aWRlbyBbY2xkdmlkXT1cInZpZFwiIFtzb3VyY2VzXT1cInNvdXJjZXNcIiBjb250cm9scz48L2FkdmFuY2VkLXZpZGVvPlxuICovXG5AQ29tcG9uZW50KHtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxuICBzZWxlY3RvcjogJ2FkdmFuY2VkLXZpZGVvJyxcbiAgdGVtcGxhdGU6IGA8dmlkZW8gKHBsYXkpPVwiZW1pdFBsYXlFdmVudCgpXCJcbiAgICAgICAgICAgICAgICAgICAgKGxvYWRzdGFydCk9XCJlbWl0TG9hZHN0YXJ0RXZlbnQoKVwiXG4gICAgICAgICAgICAgICAgICAgIChwbGF5aW5nKT1cImVtaXRQbGF5aW5nRXZlbnQoKVwiXG4gICAgICAgICAgICAgICAgICAgIChlcnJvcik9XCJlbWl0RXJyb3JFdmVudFwiXG4gICAgICAgICAgICAgICAgICAgIChlbmRlZCk9XCJlbWl0RW5kZWRFdmVudFwiPlxuICAgICAgICAgICAgPC92aWRlbz5gLFxufSlcbmV4cG9ydCBjbGFzcyBDbG91ZGluYXJ5VmlkZW9Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZikgeyB9XG5cbiAgQElucHV0KCdjbGRWaWQnKSBjbGRWaWQ6IENsb3VkaW5hcnlWaWRlbztcbiAgQElucHV0KCdjbGRQb3N0ZXInKSBjbGRQb3N0ZXI6IFZpZGVvUG9zdGVyO1xuICBASW5wdXQoJ3NvdXJjZXMnKSBzb3VyY2VzOiBWaWRlb1NvdXJjZXM7XG4gIEBJbnB1dCgncGx1Z2lucycpIHBsdWdpbnM6IFBsdWdpbnM7XG4gIEBJbnB1dCgncG9zdGVyJykgcG9zdGVyOiBzdHJpbmc7XG4gIEBJbnB1dCgnaW5uZXJSZWYnKSBpbm5lclJlZjogRWxlbWVudFJlZjtcblxuICAvLyBFdmVudCBlbWl0dGVyc1xuICBAT3V0cHV0KCkgcGxheTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBsb2Fkc3RhcnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgcGxheWluZzogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBlcnJvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBlbmRlZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgLy8gc3VwcG9ydGVkIHZpZGVvIGF0dHJpYnV0ZXNcbiAgY29udHJvbHMgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuYXR0cmlidXRlcy5jb250cm9scztcbiAgbG9vcCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5hdHRyaWJ1dGVzLmxvb3A7XG4gIG11dGVkID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LmF0dHJpYnV0ZXMubXV0ZWQ7XG4gIHByZWxvYWQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuYXR0cmlidXRlcy5wcmVsb2FkO1xuICBhdXRvUGxheSA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5hdHRyaWJ1dGVzLmF1dG9wbGF5O1xuICBwbGF5c0lubGluZSA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5hdHRyaWJ1dGVzLnBsYXlzSW5saW5lO1xuXG4gIHByaXZhdGUgaHRtbFZpZGVvTGF5ZXJJbnN0YW5jZTogSHRtbFZpZGVvTGF5ZXI7XG5cbiAgLyoqXG4gICAqIE9uIGluaXQgY3JlYXRlcyBhIG5ldyBIVE1MVmlkZW9MYXllciBpbnN0YW5jZSBhbmQgaW5pdGlhbGl6ZXMgd2l0aCByZWYgdG8gdmlkZW8gZWxlbWVudCxcbiAgICogdXNlciBnZW5lcmF0ZWQgY2xvdWRpbmFyeVZpZGVvIGFuZCB0aGUgcGx1Z2lucyB0byBiZSB1c2VkLlxuICAgKi9cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5odG1sVmlkZW9MYXllckluc3RhbmNlID0gbmV3IEh0bWxWaWRlb0xheWVyKFxuICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLFxuICAgICAgdGhpcy5jbGRWaWQsXG4gICAgICB0aGlzLnNvdXJjZXMsXG4gICAgICB0aGlzLnBsdWdpbnMsXG4gICAgICB0aGlzLmdldFZpZGVvQXR0cmlidXRlcygpLFxuICAgICAgdGhpcy5jbGRQb3N0ZXJcbiAgICAgICk7XG5cbiAgICAvLyBjaGVjayBpZiB2aWRlbyBzaG91bGQgYmUgbXV0ZWQuIFdlIG5lZWQgdG8gdGFrZSBjYXJlIG9mIHRoaXMgaGVyZSBzaW5jZSBBbmd1bGFyIGhhcyBhIGJ1ZyB3aXRoIGJpbmRpbmcgdGhlIG11dGVkXG4gICAgLy8gYXR0cmlidXRlXG4gICAgaWYgKHRoaXMubXV0ZWQpIHtcbiAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXS5tdXRlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgLy8gYXR0YWNoIHJlZiB0byBpbm5lclJlZiBpbnB1dFxuICAgIHRoaXMuYXR0YWNoUmVmKCk7XG4gIH1cblxuICAvKipcbiAgICogT24gdXBkYXRlLCB3ZSBjYW5jZWwgcnVubmluZyBwbHVnaW5zIGFuZCB1cGRhdGUgdGhlIHZpZGVvIGluc3RhbmNlIGlmIHRoZSBzcmNcbiAgICogd2FzIGNoYW5nZWQuXG4gICAqL1xuICBuZ09uQ2hhbmdlcygpIHtcbiAgICBpZiAodGhpcy5odG1sVmlkZW9MYXllckluc3RhbmNlKSB7XG4gICAgICBjYW5jZWxDdXJyZW50bHlSdW5uaW5nUGx1Z2lucyh0aGlzLmh0bWxWaWRlb0xheWVySW5zdGFuY2UuaHRtbFBsdWdpblN0YXRlKTtcbiAgICAgIHRoaXMuaHRtbFZpZGVvTGF5ZXJJbnN0YW5jZS51cGRhdGUodGhpcy5jbGRWaWQsIHRoaXMuc291cmNlcywgdGhpcy5wbHVnaW5zLCB0aGlzLmdldFZpZGVvQXR0cmlidXRlcygpLCB0aGlzLmNsZFBvc3Rlcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE9uIGRlc3Ryb3ksIHdlIGNhbmNlbCB0aGUgY3VycmVudGx5IHJ1bm5pbmcgcGx1Z2lucy5cbiAgICovXG4gIG5nT25EZXN0cm95KCkge1xuICAgIC8vIFNhZmVseSBjYW5jZWwgcnVubmluZyBldmVudHMgb24gZGVzdHJveVxuICAgIGNhbmNlbEN1cnJlbnRseVJ1bm5pbmdQbHVnaW5zKHRoaXMuaHRtbFZpZGVvTGF5ZXJJbnN0YW5jZS5odG1sUGx1Z2luU3RhdGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdmlkZW8gYXR0cmlidXRlcy5cbiAgICovXG4gIGdldFZpZGVvQXR0cmlidXRlcygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgY29udHJvbHM6IHRoaXMuY29udHJvbHMsXG4gICAgICBsb29wOiB0aGlzLmxvb3AsXG4gICAgICBtdXRlZDogdGhpcy5tdXRlZCxcbiAgICAgIHBvc3RlcjogdGhpcy5wb3N0ZXIsXG4gICAgICBwcmVsb2FkOiB0aGlzLnByZWxvYWQsXG4gICAgICBhdXRvcGxheTogdGhpcy5hdXRvUGxheSxcbiAgICAgIHBsYXlzaW5saW5lOiB0aGlzLnBsYXlzSW5saW5lXG4gICAgfTtcbiAgfVxuXG4gIGVtaXRQbGF5RXZlbnQoKSB7XG4gICAgdGhpcy5wbGF5LmVtaXQoKTtcbiAgfVxuXG4gIGVtaXRMb2Fkc3RhcnRFdmVudCgpIHtcbiAgICB0aGlzLmxvYWRzdGFydC5lbWl0KCk7XG4gIH1cblxuICBlbWl0UGxheWluZ0V2ZW50KCkge1xuICAgIHRoaXMucGxheWluZy5lbWl0KCk7XG4gIH1cblxuICBlbWl0RXJyb3JFdmVudCgpIHtcbiAgICB0aGlzLmVycm9yLmVtaXQoKTtcbiAgfVxuXG4gIGVtaXRFbmRlZEV2ZW50KCkge1xuICAgIHRoaXMuZW5kZWQuZW1pdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEF0dGFjaCBib3RoIHRoaXMudmlkZW9SZWYgYW5kIHByb3BzLmlubmVyUmVmIGFzIHJlZiB0byB0aGUgZ2l2ZW4gZWxlbWVudC5cbiAgICovXG4gIGF0dGFjaFJlZigpIHtcbiAgICBpZiAodGhpcy5pbm5lclJlZikge1xuICAgICAgdGhpcy5pbm5lclJlZi5uYXRpdmVFbGVtZW50ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdO1xuICAgIH1cbiAgfVxufVxuIl19